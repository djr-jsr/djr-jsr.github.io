<!DOCTYPE html>
<html>
	<head>
		<title>Shopping Website</title>
	</head>
	<body onload="cookie_load()" style="margin:100px">
		<style type="text/css">
			table, th, td {
				border: 1px solid black;
				border-collapse: collapse;
			}
		</style>
		<h1>Products</h1>
		<p><ul>
			<li><p name="name" style="text-align:left;">
				Laptop
				<span style="float:right">Rs. 40000</span>
				<br>
				<span style="float:right; color:blue" onclick="addItem(this.parentElement)">Add to Cart</span>
			</p></li>
			<br>
			<li><p name="name" style="text-align:left;">
				Mobile Phone
				<span style="float:right">Rs. 20000</span>
				<br>
				<span style="float:right; color:blue" onclick="addItem(this.parentElement)">Add to Cart</span>
			</p></li>
			<br>
			<li><p name="name" style="text-align:left;">
				Headphones
				<span style="float:right">Rs. 5000</span>
				<br>
				<span style="float:right; color:blue" onclick="addItem(this.parentElement)">Add to Cart</span>
			</p></li>
			<br>
			<li><p name="name" style="text-align:left;">
				Tablet
				<span style="float:right">Rs. 30000</span>
				<br>
				<span style="float:right; color:blue" onclick="addItem(this.parentElement)">Add to Cart</span>
			</p></li>
		</ul></p>
		<h1>Cart</h1>
		<table style="width:100%" id="mytable">
			<thead>
				<tr>
					<th>Products</th>
					<th>Quantity</th>
					<th>Rate</th>
					<th>Cost</th>
				</tr>
			</thead>
			<tfoot>
			<tr>
				<td colspan="3">Total</td>
				<td id="total_cost">Rs. 0</td>
			</tr>
			</tfoot>
			<tbody id="table">
				<!-- <tr>
						<td><button onclick="removeRow(this.parentElement.parentElement)">X</button> Laptop</td>
						<td><button>-</button> 1 <button>+</button></td>
						<td>Rs. 40000</td>
						<td>Rs. 40000</td>
				</tr> -->
			</tbody>
		</table>
	</body>
	<script type="text/javascript">
		function addItem(list_elem){
			console.log(list_elem.innerText)
			var str = list_elem.innerText.trim()
			var product = str.substring(0, str.indexOf("Rs.")).trim()
			var cost = str.substring(str.indexOf("Rs. ") + 3, str.indexOf("Add to Cart")).trim()
			console.log(product)
			console.log(cost)
			
			var table = document.getElementById("table");
			found = false;
			for (var i = 0, row; row = table.rows[i]; i++) {
				//iterate through rows
				//rows would be accessed using the "row" variable assigned in the for loop
				var product_t = row.cells[0].innerText.substring(2).trim()
				if(product_t === product)
				{
					var quantity = row.cells[1].innerText.substring(2, row.cells[1].innerText.indexOf("+")).trim()
					quantity = parseInt(quantity) + 1;
					rate_t = cost;
					cost_t = parseInt(rate_t) * quantity;
					document.getElementById("table").rows[i].cells[0].innerHTML = "<button onclick=\"removeRow(this)\">X</button> " + product_t
					document.getElementById("table").rows[i].cells[1].innerHTML = "<button onclick=\"decreaseQuan(this.parentNode.parentNode)\">-</button> " + quantity + " <button onclick=\"increaseQuan(this.parentNode.parentNode)\">+</button>"
					document.getElementById("table").rows[i].cells[2].innerHTML = "Rs. " + rate_t
					document.getElementById("table").rows[i].cells[3].innerHTML = "Rs. " + cost_t
					found = true;
					break;
				}
			}
			if (!found) {
				var table = document.getElementById("table");
				var row = table.insertRow(-1);
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);
				cell1.innerHTML = "<button onclick=\"removeRow(this)\">X</button> " + product
				cell2.innerHTML = "<button onclick=\"decreaseQuan(this.parentNode.parentNode)\">-</button> " + 1 + " <button onclick=\"increaseQuan(this.parentNode.parentNode)\">+</button>";
				cell3.innerHTML = "Rs. " + cost;
				cell4.innerHTML = "Rs. " + cost;
			}
			updateTotal();
		}
		function updateTotal(){
			var table = document.getElementById("table");
			var tot = 0;
			for (var i = 0, row; row = table.rows[i]; i++) {
				//iterate through rows
				//rows would be accessed using the "row" variable assigned in the for loop
				var str = row.cells[3].innerHTML
				var cost = str.substring(str.indexOf("Rs. ") + 3).trim()
				tot = tot + parseInt(cost)
			}
			document.getElementById("total_cost").innerHTML = "Rs. " + tot

			setCookie("table_cookie", document.getElementById("mytable").innerHTML, 5)
		}

		function removeRow(o){
			var p = o.parentNode.parentNode;
			p.parentNode.removeChild(p);
			updateTotal()
		}

		function increaseQuan(row)
		{
			var quantity = row.cells[1].innerText.substring(2, row.cells[1].innerText.indexOf("+")).trim()
			quantity = parseInt(quantity) + 1;
			rate_t = row.cells[2].innerText.substring(row.cells[2].innerText.indexOf("Rs. ") + 3);
			cost_t = parseInt(rate_t) * quantity;
			// document.getElementById("table").rows[i].cells[0].innerHTML = "<button onclick=\"removeRow(this)\">X</button> " + product_t
			row.cells[1].innerHTML = "<button  onclick=\"decreaseQuan(this.parentNode.parentNode)\">-</button> " + quantity + " <button onclick=\"increaseQuan(this.parentNode.parentNode)\">+</button>"
			row.cells[2].innerHTML = "Rs. " + rate_t
			row.cells[3].innerHTML = "Rs. " + cost_t
			updateTotal()
		}

		function decreaseQuan(row){
			var quantity = row.cells[1].innerText.substring(2, row.cells[1].innerText.indexOf("+")).trim()
			quantity = parseInt(quantity) - 1;
			rate_t = row.cells[2].innerText.substring(row.cells[2].innerText.indexOf("Rs. ") + 3);
			cost_t = parseInt(rate_t) * quantity;
			// document.getElementById("table").rows[i].cells[0].innerHTML = "<button onclick=\"removeRow(this)\">X</button> " + product_t
			row.cells[1].innerHTML = "<button  onclick=\"decreaseQuan(this.parentNode.parentNode)\">-</button> " + quantity + " <button onclick=\"increaseQuan(this.parentNode.parentNode)\">+</button>"
			row.cells[2].innerHTML = "Rs. " + rate_t
			row.cells[3].innerHTML = "Rs. " + cost_t
			if (quantity <= 0) {
				row.parentNode.removeChild(row);
			}
			updateTotal()
		}

		function cookie_load(){
			var data = getCookie("table_cookie")
			if(data != ""){
				document.getElementById("mytable").innerHTML = data
			}
			console.log("cookie load")
		}

		function setCookie(cname, cvalue, exdays) {
		    var d = new Date();
		    d.setTime(d.getTime() + (exdays*24*60*60*1000));
		    var expires = "expires="+d.toUTCString();
		    document.cookie = cname + "=" + cvalue + ", " + expires;
		    console.log("cookie set")
		}

		function getCookie(cname) {
		    var name = cname + "=";
		    var ca = document.cookie.split(';');
		    for(var i = 0; i < ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0) == ' ') {
		            c = c.substring(1);
		        }
		        if (c.indexOf(name) == 0) {
		            return c.substring(name.length, c.length);
		        }
		    }
		    return "";
		}

		function checkCookie(cname) {
		    var user = getCookie("username");
		    if (user != "") {
		        alert("Welcome again " + user);
		    } else {
		        user = prompt("Please enter your name:", "");
		        if (user != "" && user != null) {
		            setCookie("username", user, 365);
		        }
		    }
		}
	</script>
</html>